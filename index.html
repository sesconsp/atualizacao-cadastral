<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Atualiza√ß√£o Cadastral - Sescon-SP</title>
    <link rel="icon" href="https://sescon.org.br/wp-content/uploads/2020/09/cropped-favicon-32x32.png" sizes="32x32">
    <link rel="icon" href="https://sescon.org.br/wp-content/uploads/2020/09/cropped-favicon-192x192.png" sizes="192x192">
    
    <style>
        /* ... todo o seu CSS continua aqui, sem altera√ß√µes ... */
        body { margin: 0; font-family: 'Roboto', Arial, sans-serif; display: flex; justify-content: center; align-items: center; min-height: 100vh; background: url('https://i.imgur.com/iE3JKYM.png' ) no-repeat center center fixed; background-size: cover; padding: 20px 0; }
        .container { background-color: rgba(0, 151, 206, 0.6); padding: 22px; border-radius: 12px; width: 100%; max-width: 600px; color: #fff; box-shadow: 0 6px 15px rgba(0, 0, 0, 0.2); }
        h1 { text-align: center; color: #fff; margin-bottom: 5px; font-size: 1.7em; }
        .subtitulo-sescon { text-align: center; color: #fff; font-size: 1.4em; margin-top: 0px; margin-bottom: 20px; font-weight: bold; }
        .descricao { text-align: center; font-size: 1.05em; color: #fff; margin-bottom: 18px; line-height: 1.5em; }
        section { margin-bottom: 24px; padding: 18px; border-radius: 10px; background-color: rgba(255, 255, 255, 0.85); border: 1px solid #0097ce; }
        section h2 { color: #0097ce; font-size: 1.3em; margin-bottom: 15px; }
        label { display: block; font-weight: bold; margin-bottom: 8px; color: #333; }
        input[type="text"], input[type="email"], input[type="tel"], input[type="number"], input[type="date"], select { width: 100%; padding: 12px; border: 1px solid #ccc; border-radius: 6px; font-size: 16px; margin-bottom: 12px; box-sizing: border-box; }
        .comunicacao-titulo { font-weight: bold; color: #333; margin-bottom: 8px; }
        .checkbox-label { display: flex; align-items: center; margin-bottom: 8px; font-weight: normal; }
        .checkbox-label input[type="checkbox"] { width: auto; margin-right: 10px; }
        .btn-add, .btn-submit, .btn-reveal { background-color: #fff; color: #0097ce; padding: 12px 20px; border: 1px solid #0097ce; border-radius: 8px; cursor: pointer; font-size: 16px; font-weight: bold; display: inline-block; transition: all 0.3s ease; }
        .btn-add:hover, .btn-submit:hover, .btn-reveal:hover { background-color: #0097ce; color: #fff; }
        .btn-submit, .btn-reveal { width: 100%; margin-top: 10px; }
        .mensagem-status { text-align: center; font-size: 1.1em; margin-top: 15px; display: none; padding: 10px; border-radius: 6px; }
        .mensagem-sucesso { background-color: #d4edda; color: #155724; }
        .mensagem-erro { background-color: #f8d7da; color: #721c24; }
        footer { text-align: center; margin-top: 30px; }
        footer .logo { display: block; margin: 0 auto; max-width: 140px; height: auto; }
        .item-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; }
        .item-header h3 { color: #0097ce; font-size: 1.2em; margin: 0; }
        .btn-remove { background-color: #ff4d4d; color: white; padding: 5px 10px; border: none; border-radius: 6px; cursor: pointer; font-size: 0.9em; font-weight: bold; transition: background-color 0.3s ease; }
        .btn-remove:hover { background-color: #d43f3f; }
        .item-block { border-top: 1px solid #ddd; margin-top: 20px; padding-top: 20px; }
        .hidden { display: none; }
    </style>
</head>
<body>
    <!-- ... todo o seu HTML do body continua aqui, sem altera√ß√µes ... -->
    <div class="container">
        <h1>Atualize seus dados cadastrais conosco</h1>
        <p class="subtitulo-sescon">Sescon - SP</p>
        <p class="descricao">Preencha corretamente as informa√ß√µes. Pelo menos um contato √© obrigat√≥rio para garantirmos a comunica√ß√£o eficaz.</p>

        <form id="formulario">
            <!-- SE√á√ÉO 1: IDENTIFICA√á√ÉO -->
            <section>
                <h2>1. Identifica√ß√£o da Empresa</h2>
                <label for="cnpj">CNPJ:</label>
                <input type="text" id="cnpj" name="cnpj" readonly>
                <label for="razao">Raz√£o Social:</label>
                <input type="text" id="razao" name="razao" readonly>
            </section>

            <!-- SE√á√ÉO 2: CONTATOS -->
            <section id="contact-section">
                <h2>2. Contatos</h2>
                <div class="contact-item">
                    <div class="item-header"><h3>Contato 1 (Obrigat√≥rio)</h3></div>
                    <label>Este e-mail receber√° os comunicados selecionados abaixo:</label>
                    <input type="email" name="email[]" placeholder="ex: contato@empresa.com" required>
                    <label>Telefone:</label>
                    <input type="tel" name="telefone[]" placeholder="(DD) 99999-9999" required>
                    <label>Departamento:</label>
                    <select name="departamento[]" required>
                        <option value="">Selecione</option><option value="Socio">S√≥cio</option><option value="Diretoria">Diretoria</option><option value="Recursos Humanos">Recursos Humanos (RH)</option><option value="Departamento Pessoal">Departamento Pessoal</option><option value="Financeiro">Financeiro</option><option value="Contabilidade">Contabilidade</option><option value="Juridico">Jur√≠dico</option><option value="Marketing">Marketing</option><option value="Outros">Outros</option>
                    </select>
                    <p class="comunicacao-titulo">Selecione os tipos de comunica√ß√£o que deseja receber:</p>
                    <label class="checkbox-label"><input type="checkbox" name="comunicacoes[]" value="Boletos"> Boletos e Comunicados Financeiros</label>
                    <label class="checkbox-label"><input type="checkbox" name="comunicacoes[]" value="Cursos"> Cursos, eventos e outros produtos e servi√ßos</label>
                    <label class="checkbox-label"><input type="checkbox" name="comunicacoes[]" value="Assembleias"> Convoca√ß√µes para Assembleias</label>
                    <label class="checkbox-label" style="margin-bottom: 20px;"><input type="checkbox" name="comunicacoes[]" value="Noticias"> Not√≠cias e Informativos Gerais</label>
                </div>
                <button type="button" class="btn-add" onclick="addContact()">+ Adicionar Contato</button>
            </section>

            <!-- SE√á√ÉO 3: INFORMA√á√ïES DA EMPRESA -->
            <section>
                <h2>3. Informa√ß√µes da Empresa</h2>
                <label for="faturamento">Faturamento Bruto Anual (para c√°lculo das contribui√ß√µes):</label>
                <input type="text" id="faturamento" name="faturamento" placeholder="Ex: R$ 1.200.000,00" required>
                <label for="funcionarios">Quantidade de Funcion√°rios:</label>
                <input type="number" id="funcionarios" name="funcionarios" placeholder="Ex: 25" min="0" required>
            </section>

            <!-- SE√á√ÉO 4: S√ìCIOS E COLABORADORES -->
            <section>
                <h2>4. S√≥cios e Colaboradores (Opcional)</h2>
                <button type="button" class="btn-reveal" id="reveal-button">Deseja atualizar s√≥cios ou colaboradores? Clique aqui</button>
                <div id="optional-section" class="hidden">
                    <div id="socios-container">
                        <div class="item-header" style="margin-top: 15px;"><h3>S√≥cios</h3></div>
                        <button type="button" class="btn-add" onclick="addSocio()">+ Adicionar S√≥cio</button>
                    </div>
                    <div id="colaboradores-container" class="item-block">
                        <div class="item-header"><h3>Colaboradores</h3></div>
                        <button type="button" class="btn-add" onclick="addColaborador()">+ Adicionar Colaborador</button>
                    </div>
                </div>
            </section>

            <button type="submit" class="btn-submit">Enviar Atualiza√ß√£o</button>
            <p class="mensagem-status"></p>
        </form>
        <footer><img src="https://i.imgur.com/zWWSzuu.png" alt="Logo Sescon-SP" class="logo"></footer>
    </div>

    <script>
        // ========================================================================
        // NOVA FUN√á√ÉO PARA DEFINIR LIMITES DE DATA
        // ========================================================================
        function setDateLimits(dateInputElement ) {
            const today = new Date();
            const yyyy = today.getFullYear();
            const mm = String(today.getMonth() + 1).padStart(2, '0'); // Janeiro √© 0
            const dd = String(today.getDate()).padStart(2, '0');
            
            const maxDate = `${yyyy}-${mm}-${dd}`;
            
            dateInputElement.setAttribute('max', maxDate);
            dateInputElement.setAttribute('min', '1930-01-01');
        }

        document.getElementById('reveal-button').addEventListener('click', function() {
            document.getElementById('optional-section').classList.remove('hidden');
            this.classList.add('hidden');
        });

        function applyPhoneMask(element) { /* ...c√≥digo da m√°scara... */ }
        function applyCurrencyMask(element) { /* ...c√≥digo da m√°scara... */ }
        function applyCpfMask(element) { /* ...c√≥digo da m√°scara... */ }

        function addContact() {
            const container = document.getElementById('contact-section');
            const count = container.querySelectorAll('.contact-item').length + 1;
            const newContact = document.createElement('div');
            newContact.className = 'contact-item item-block';
            newContact.innerHTML = `
                <div class="item-header"><h3>Contato ${count}</h3><span class="btn-remove" onclick="this.parentElement.parentElement.remove()">Remover</span></div>
                <label>E-mail:</label><input type="email" name="email[]" placeholder="ex: contato@empresa.com">
                <label>Telefone:</label><input type="tel" name="telefone[]" placeholder="(DD) 99999-9999">
                <label>Departamento:</label><select name="departamento[]"><option value="">Selecione</option><option value="Socio">S√≥cio</option><option value="Diretoria">Diretoria</option><option value="Recursos Humanos">RH</option><option value="Departamento Pessoal">DP</option><option value="Financeiro">Financeiro</option><option value="Contabilidade">Contabilidade</option><option value="Juridico">Jur√≠dico</option><option value="Marketing">Marketing</option><option value="Outros">Outros</option></select>
                <p class="comunicacao-titulo">Selecione os tipos de comunica√ß√£o que deseja receber:</p>
                <label class="checkbox-label"><input type="checkbox" name="comunicacoes[]" value="Boletos"> Boletos e Comunicados Financeiros</label>
                <label class="checkbox-label"><input type="checkbox" name="comunicacoes[]" value="Cursos"> Cursos, eventos e outros produtos e servi√ßos</label>
                <label class="checkbox-label"><input type="checkbox" name="comunicacoes[]" value="Assembleias"> Convoca√ß√µes para Assembleias</label>
                <label class="checkbox-label" style="margin-bottom: 20px;"><input type="checkbox" name="comunicacoes[]" value="Noticias"> Not√≠cias e Informativos Gerais</label>
            `;
            container.insertBefore(newContact, container.querySelector('.btn-add'));
            applyPhoneMask(newContact.querySelector('input[name="telefone[]"]'));
        }

        function addSocio() {
            const container = document.getElementById('socios-container');
            const count = container.querySelectorAll('.item-block').length + 1;
            const newSocio = document.createElement('div');
            newSocio.className = 'item-block';
            newSocio.innerHTML = `<div class="item-header"><h3>S√≥cio ${count}</h3><span class="btn-remove" onclick="this.parentElement.parentElement.remove()">Remover</span></div><label>Nome do S√≥cio:</label><input type="text" name="socio_nome[]"><label>CPF do S√≥cio:</label><input type="text" name="socio_cpf[]" placeholder="000.000.000-00"><label>Data de Entrada:</label><input type="date" name="socio_data[]">`;
            container.insertBefore(newSocio, container.querySelector('.btn-add'));
            
            const dateInput = newSocio.querySelector('input[name="socio_data[]"]');
            setDateLimits(dateInput); // <-- APLICA O LIMITE NO NOVO CAMPO
            
            applyCpfMask(newSocio.querySelector('input[name="socio_cpf[]"]'));
        }

        function addColaborador() {
            const container = document.getElementById('colaboradores-container');
            const count = container.querySelectorAll('.item-block').length + 1;
            const newColaborador = document.createElement('div');
            newColaborador.className = 'item-block';
            newColaborador.innerHTML = `<div class="item-header"><h3>Colaborador ${count}</h3><span class="btn-remove" onclick="this.parentElement.parentElement.remove()">Remover</span></div><label>Nome do Colaborador:</label><input type="text" name="colaborador_nome[]"><label>CPF do Colaborador:</label><input type="text" name="colaborador_cpf[]" placeholder="000.000.000-00"><label>Data de Admiss√£o:</label><input type="date" name="colaborador_data[]">`;
            container.insertBefore(newColaborador, container.querySelector('.btn-add'));

            const dateInput = newColaborador.querySelector('input[name="colaborador_data[]"]');
            setDateLimits(dateInput); // <-- APLICA O LIMITE NO NOVO CAMPO

            applyCpfMask(newColaborador.querySelector('input[name="colaborador_cpf[]"]'));
        }

        // ... resto do seu script (submit, m√°scaras, etc.) continua aqui ...
        document.getElementById('formulario').addEventListener('submit', function (e) {
            e.preventDefault();
            const statusMsg = document.querySelector('.mensagem-status');
            statusMsg.style.display = 'block';
            const firstContact = document.querySelector('.contact-item');
            if (!firstContact.querySelector('input[name="email[]"]').value || !firstContact.querySelector('input[name="telefone[]"]').value) {
                statusMsg.textContent = 'Por favor, preencha pelo menos o e-mail e telefone do Contato 1.';
                statusMsg.className = 'mensagem-status mensagem-erro';
                return;
            }
            statusMsg.textContent = 'Enviando...';
            statusMsg.className = 'mensagem-status';
            const payload = {
                cnpj: document.getElementById('cnpj').value,
                razaoSocial: document.getElementById('razao').value,
                faturamento: document.getElementById('faturamento').value,
                funcionarios: document.getElementById('funcionarios').value,
                contatos: Array.from(document.querySelectorAll('.contact-item')).map(item => ({ email: item.querySelector('input[name="email[]"]').value, telefone: item.querySelector('input[name="telefone[]"]').value, departamento: item.querySelector('select[name="departamento[]"]').value, preferencias: Array.from(item.querySelectorAll('input[name="comunicacoes[]"]:checked')).map(el => el.value) })).filter(c => c.email),
                socios: Array.from(document.querySelectorAll('#socios-container .item-block')).map(item => ({ nome: item.querySelector('input[name="socio_nome[]"]').value, cpf: item.querySelector('input[name="socio_cpf[]"]').value, data: item.querySelector('input[name="socio_data[]"]').value })).filter(s => s.nome),
                colaboradores: Array.from(document.querySelectorAll('#colaboradores-container .item-block')).map(item => ({ nome: item.querySelector('input[name="colaborador_nome[]"]').value, cpf: item.querySelector('input[name="colaborador_cpf[]"]').value, data: item.querySelector('input[name="colaborador_data[]"]').value })).filter(c => c.nome)
            };
            const url = 'https://script.google.com/macros/s/AKfycbz_iWAlH4-4x5r6nYxRptYFlKsCXMQW_Q5ED9ejkAqm2mQ1T3559Zkz8P7wso8dAVB5/exec'; // <-- N√ÉO ESQUE√áA DE COLAR SUA NOVA URL AQUI
            fetch(url, { method: 'POST', mode: 'no-cors', cache: 'no-cache', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload), redirect: 'follow' })
            .then(res => {
                statusMsg.textContent = '‚úÖ Dados enviados com sucesso!üì©';
                statusMsg.className = 'mensagem-status mensagem-sucesso';
                document.getElementById('formulario').reset();
                document.getElementById('optional-section').classList.add('hidden');
                document.getElementById('reveal-button').classList.remove('hidden');
            }).catch(error => {
                statusMsg.textContent = '‚ùå Ocorreu um erro. Tente novamente.';
                statusMsg.className = 'mensagem-status mensagem-erro';
            });
        });
        const urlParams = new URLSearchParams(window.location.search);
        if (urlParams.has('cnpj')) document.getElementById('cnpj').value = urlParams.get('cnpj');
        if (urlParams.has('razaoSocial')) document.getElementById('razao').value = urlParams.get('razaoSocial');
        
        document.querySelectorAll('input[name="telefone[]"]').forEach(applyPhoneMask);
        applyCurrencyMask(document.getElementById('faturamento'));
    </script>
</body>
</html>
